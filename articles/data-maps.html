<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data Maps • osmplotr</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Maps">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">osmplotr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.5.006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/osmplotr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data Maps</h1>
                        <h4 data-toc-skip class="author">Mark
Padgham</h4>
            
            <h4 data-toc-skip class="date">2024-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/osmplotr/blob/master/vignettes/data-maps.Rmd" class="external-link"><code>vignettes/data-maps.Rmd</code></a></small>
      <div class="d-none name"><code>data-maps.Rmd</code></div>
    </div>

    
    
<p>This vignette extends from the vignette (<a href="https://cran.r-project.org/package=osmplotr" class="external-link">Basic maps</a>) to
demonstrate how <code>osmplotr</code> enables the graphical properties
of OpenStreetMap objects to be modified according to user-provided data.
Categorical data can be plotted by highlighting defined regions with
different colours using <code>add_osm_groups</code>, while continuous
data can be plotted with <code>add_osm_surface</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmplotr/">osmplotr</a></span><span class="op">)</span></span></code></pre></div>
<p>As in the first vignette, maps produced in this vignette contain data
for a small portion of central London, U.K.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_bbox.html">get_bbox</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">0.13</span>, <span class="fl">51.51</span>, <span class="op">-</span><span class="fl">0.11</span>, <span class="fl">51.52</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="categorical-data-add_osm_groups">1. Categorical data: <code>add_osm_groups</code><a class="anchor" aria-label="anchor" href="#categorical-data-add_osm_groups"></a>
</h2>
<p>The function <code>add_osm_groups</code> enables spatially-defined
groups to be plotted in different colours. The two primary arguments are
<code>obj</code>, which defines the OSM structure to be used for
plotting the regions, and <code>groups</code> which is a list of
geometric coordinates defining the desired regions. An example of an
<code>obj</code> is the Simple Features (<a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a>)
<code>data.frame</code> of building polygons downloaded in the first
vignette with the following line</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_osm_objects.html">extract_osm_objects</a></span> <span class="op">(</span>key <span class="op">=</span> <span class="st">"building"</span>, bbox <span class="op">=</span> <span class="va">bbox</span><span class="op">)</span></span></code></pre></div>
<p>These data may be obtained by simply combining the data provided with
the package of residential and non-residential buildings to give all
buildings as</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span> <span class="op">(</span><span class="va">london</span><span class="op">$</span><span class="va">dat_BNR</span>, <span class="va">london</span><span class="op">$</span><span class="va">dat_BR</span><span class="op">)</span></span></code></pre></div>
<p>The most direct way to define <code>groups</code> is through
specifying coordinates of boundary points:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">0.115</span>, <span class="op">-</span><span class="fl">0.125</span>, <span class="op">-</span><span class="fl">0.125</span>, <span class="op">-</span><span class="fl">0.115</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">51.513</span>, <span class="fl">51.513</span>, <span class="fl">51.517</span>, <span class="fl">51.517</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">map</span>,</span>
<span>    <span class="va">dat_B</span>,</span>
<span>    groups <span class="op">=</span> <span class="va">pts</span>,</span>
<span>    cols <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray40"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="va">map</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b1.png"></p>
<p>Multiple groups can be defined by passing a list of multiple sets of
point coordinates to the <code>groups</code> argument of
<code>add_osm_groups</code>, and specifying corresponding colours.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">0.111</span>, <span class="op">-</span><span class="fl">0.1145</span>, <span class="op">-</span><span class="fl">0.1145</span>, <span class="op">-</span><span class="fl">0.111</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">51.517</span>, <span class="fl">51.517</span>, <span class="fl">51.519</span>, <span class="fl">51.519</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">map</span>,</span>
<span>    <span class="va">dat_B</span>,</span>
<span>    groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray40"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="va">map</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b2.png"></p>
<p>The <code>bg</code> argument specifies the colour of any objects
lying outside the boundaries of the specified groups. If this argument
is not given, then all objects are assigned to the nearest group, so
that the groups fill the entire map.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">map</span>,</span>
<span>    <span class="va">dat_B</span>,</span>
<span>    groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="va">map</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b3.png"></p>
<p>Now that you’ve seen the general workflow of <code>osmplotr</code>,
let’s repeat the previous code, but streamline it with
<code>magrittr</code>’s <code>%&gt;%</code> function. This allows us to
pipe the functions together instead of re-assigning the <code>map</code>
variable.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b3_pipe.png"></p>
<div class="section level3">
<h3 id="hulls-around-groups">1.1 Hulls around groups<a class="anchor" aria-label="anchor" href="#hulls-around-groups"></a>
</h3>
<p><code>add_osm_groups</code> includes the argument
<code>make_hull</code> which specifies whether convex hulls should be
fitted around the points defining the provided <code>groups</code>, or
whether the <code>groups</code> already define their own boundaries (the
default behaviour). If a point is added internal to the four points
defining the first of the above groups, then the group boundary will
connect to that point and create a concave shape.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="op">-</span><span class="fl">0.12</span>, <span class="fl">51.515</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">pts</span>,</span>
<span>        cols <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray40"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b5.png"></p>
<p>The previous points started in the south-east and ended in the
north-east, and thus the concave boundary extends in between the two
easterly points. Setting <code>make_hull = TRUE</code> defines groups by
the convex hulls surrounding them, which in this case would revert this
map to the initial map with the group defined by a regular, convex
perimeter.</p>
</div>
<div class="section level3">
<h3 id="inclusive-exclusive-and-bisected-polygons">1.2 Inclusive, exclusive, and bisected polygons<a class="anchor" aria-label="anchor" href="#inclusive-exclusive-and-bisected-polygons"></a>
</h3>
<p>The highlighted regions of the previous maps are irregular because
the default behaviour of <code>add_osm_groups</code> is to include
within a group only those OSM objects which lie entirely within a group
boundary. <code>add_osm_groups</code> has a <code>boundary</code>
argument which defines whether objects should be assigned to groups
inclusively (<code>boundary &gt; 0</code>) or exclusively
(<code>boundary &lt; 0</code>), or whether they should be precisely
bisected by a group boundary (<code>boundary = 0</code>). The previous
maps illustrate the default option (<code>boundary = -1</code>), while
the two other options produce the following maps.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, bg <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        make_hull <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray40"</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b6.png"></p>
<p>The inclusive option (<code>boundary&gt;0</code>) includes all
objects which have any points lying within a boundary, meaning more
objects are included resulting in larger regions than the previous
default exclusive option. Precisely bisecting boundaries produces the
following map.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        make_hull <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray40"</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b7.png"></p>
<p>The ability to combine different kinds of boundaries is particularly
useful when highlighting areas which partially contain large polygons
such as parks. The parks within the following maps were downloaded
with</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_osm_objects.html">extract_osm_objects</a></span> <span class="op">(</span>key <span class="op">=</span> <span class="st">"park"</span>, bbox <span class="op">=</span> <span class="va">bbox</span><span class="op">)</span></span></code></pre></div>
<p>(Noting that, as described in the first vignette, <a href="https://cran.r-project.org/package=osmplotr" class="external-link">Basic maps</a>, both
<code>extract_osm_objects</code> and <code>make_osm_map</code> convert
several common keys to appropriate <code>key-value</code> pairs, so</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_structures.html">osm_structures</a></span> <span class="op">(</span>structure <span class="op">=</span> <span class="st">"park"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    structure     key value suffix      cols</span></span>
<span><span class="co">## 1       park leisure  park      P #647864FF</span></span>
<span><span class="co">## 2 background                         gray20</span></span></code></pre>
<p>reveals that this <code>key</code> is actually converted to
<code>key = "leisure"</code> and <code>value = "park"</code>.) These
data are also provided with the package as
<code>london$dat_P</code>.</p>
<p>Plotting buildings inclusively within each group and overlaying parks
bisected by the group boundaries produces the following map:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_park_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span> <span class="op">(</span><span class="fl">50</span>, <span class="fl">255</span>, <span class="fl">50</span>, maxColorValue <span class="op">=</span> <span class="fl">255</span><span class="op">)</span></span>
<span><span class="va">col_park_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span> <span class="op">(</span><span class="fl">50</span>, <span class="fl">155</span>, <span class="fl">50</span>, maxColorValue <span class="op">=</span> <span class="fl">255</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        make_hull <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray40"</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_P</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span> <span class="op">(</span><span class="va">col_park_in</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="va">col_park_out</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b8.png"></p>
<p>Bisection divides single polygons to form one polygon of points lying
within a given boundary and one polygon of points lying outside the
boundary. The two resultant polygons are often separated by visible gaps
between locations at which they are defined. Because the layers of a
plot are progressively overlaid, such gaps can be avoided by initially
plotting underlying layers using <code>add_osm_objects</code> prior to
grouping objects:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_objects.html">add_osm_objects</a></span> <span class="op">(</span><span class="va">dat_P</span>,</span>
<span>        col <span class="op">=</span> <span class="va">col_park_out</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_P</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span> <span class="op">(</span><span class="va">col_park_in</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="va">col_park_out</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        make_hull <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray40"</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b9.png"></p>
<p>Bisections with <code>boundary = 0</code> will only be as accurate as
the underlying OSM data. This example was chosen to highlight that
bisection may be inaccurate if actual OSM points do not lie near to a
desired bisection line. The larger a map, the less visually evident are
likely to be any such inaccuracies. Finally, note that the plot order
was changed to allow the building within the park to be overlaid upon
the grass surfaces. Plot order, whether controlled manually or with
<code>make_osm_map</code>, may often have to be tweaked to appropriately
visualise all objects.</p>
<p>The <code>boundary</code> argument has no effect if <code>bg</code>
is not given, because in this case all objects will be assigned to a
group and there will be no boundaries between groups and other,
non-grouped objects.</p>
</div>
<div class="section level3">
<h3 id="adjusting-colours-with-adjust_colours">1.3 Adjusting colours with <code>adjust_colours</code><a class="anchor" aria-label="anchor" href="#adjusting-colours-with-adjust_colours"></a>
</h3>
<p>The <code>adjust_colours</code> function allows different groups to
be highlighted with slightly different colours for different kinds of
OSM objects. For example, the following code adds highways to the above
map in slightly darkened versions of the highlight colours (using
<code>boundary = 1</code>, so any highways with any points lying within
the bounding box are included in the groups):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create separate data for all highways and primary highways</span></span>
<span><span class="va">dat_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span> <span class="op">(</span><span class="va">london</span><span class="op">$</span><span class="va">dat_H</span>, <span class="va">london</span><span class="op">$</span><span class="va">dat_HP</span><span class="op">)</span></span>
<span><span class="va">dat_HP</span> <span class="op">&lt;-</span> <span class="va">london</span><span class="op">$</span><span class="va">dat_HP</span></span>
<span></span>
<span><span class="co"># darken colours by aboud 20%</span></span>
<span><span class="va">cols_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_colours.html">adjust_colours</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>    adj <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        make_hull <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_adj</span>,</span>
<span>        bg <span class="op">=</span> <span class="fu"><a href="../reference/adjust_colours.html">adjust_colours</a></span> <span class="op">(</span><span class="st">"gray40"</span>,</span>
<span>            adj <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span></span>
<span>        <span class="op">)</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_H</span>,</span>
<span>        groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">pts</span>, <span class="va">pts2</span><span class="op">)</span>,</span>
<span>        make_hull <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_adj</span>,</span>
<span>        bg <span class="op">=</span> <span class="fu"><a href="../reference/adjust_colours.html">adjust_colours</a></span> <span class="op">(</span><span class="st">"gray40"</span>,</span>
<span>            adj <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span></span>
<span>        <span class="op">)</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b10.png"></p>
<p>And of course <code>adjust_colours ("gray40", adj = -0.2)</code> is
nothing other than “gray32”, and <code>adj = -0.4</code> gives
“gray24”.</p>
</div>
<div class="section level3">
<h3 id="dark-on-light-highlights">1.4 Dark-on-Light Highlights<a class="anchor" aria-label="anchor" href="#dark-on-light-highlights"></a>
</h3>
<p>A particularly effective way to highlight single regions within a map
is through using dark colours upon otherwise light coloured maps.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, bg <span class="op">=</span> <span class="st">"gray95"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">pts</span>,</span>
<span>        cols <span class="op">=</span> <span class="st">"gray40"</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray85"</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_H</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">pts</span>,</span>
<span>        cols <span class="op">=</span> <span class="st">"gray20"</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray70"</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">pts</span>,</span>
<span>        cols <span class="op">=</span> <span class="st">"gray10"</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b11.png"></p>
</div>
<div class="section level3">
<h3 id="visualising-clustering-data">1.5 Visualising clustering data<a class="anchor" aria-label="anchor" href="#visualising-clustering-data"></a>
</h3>
<p>One of the most likely uses of <code>add_osm_groups</code> is to
visualise statistical clusters. Clustering algorithms will generally
produce membership lists which may be mapped onto spatial locations.
Each cluster can be defined as a matrix of points in a single list of
<code>groups</code>. A general approach is illustrated here with
<code>groups</code> defined by single, randomly generated points.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span> <span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ngroups</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">bbox</span> <span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">ngroups</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span> <span class="op">(</span><span class="va">bbox</span> <span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">bbox</span> <span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span><span class="va">ngroups</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span> <span class="op">(</span><span class="va">bbox</span> <span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span> <span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>(The last line just transforms each row of the matrix into a list
item.) Having generated the points, a map of corresponding clusters can
be generated by the following simple code.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray95"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b12.png"></p>
<p>Although individual groups will generally be defined by collections
of multiple points, this example illustrates that they can also be
defined by single points. In such cases, the <code>bg</code> option
should of course be absent, so that all remaining points are allocated
to the nearest groups.</p>
<p>This map also illustrates the kind of visual mess that may arise in
attempts to specify colours, particularly because the sequence of
colours passed to <code>add_osm_groups</code> will generally not map on
to any particular spatial order, so even if a pleasing colour scheme is
submitted, the results may still be less than desirable. Although it may
be possible to devise pleasing schemes for small numbers of groups,
manually defined colour schemes are likely to become impractical for
larger numbers of groups.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray95"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>        border_width <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span> <span class="op">(</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b13.png"></p>
<p>Note the submitting any positive values to the additional
<code>border_width</code> argument causes <code>add_osm_groups</code> to
drawn convex hull borders around the different groups. Even this is not
sufficient, however, to render the result particularly visually pleasing
or intelligible. To overcome this, <code>add_osm_groups</code> includes
an option described in the following section to generate spatially
sensible colour schemes for colouring distinct groups.</p>
</div>
<div class="section level3">
<h3 id="the-colour-matrix-colouring-several-regions">1.6 The Colour Matrix: Colouring Several Regions<a class="anchor" aria-label="anchor" href="#the-colour-matrix-colouring-several-regions"></a>
</h3>
<p>An additional argument which may be passed to
<code>add_osm_groups</code> is <code>colmat</code>, an abbreviation of
‘colour matrix’. If set to true (the default is <code>FALSE</code>),
group colours are specified by the function <code>colour_mat</code>.
This function takes a vector of four or more colours as input, wraps
them around the four corners of a rectangular grid, and spatially
interpolates a chromatically regular grid between these corners. To
visual different schemes, it has a <code>plot</code> argument:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colour_mat.html">colour_mat</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span> <span class="op">(</span><span class="fl">4</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-maps_files/figure-html/unnamed-chunk-11-1.png" width="384"></p>
<p>This grid illustrates the default colours, <code>rainbow (4)</code>.
The two-dimensional colour field produced by <code>colour_mat</code> may
also be rotated by a specified number of degrees using the
<code>rotate</code> argument.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colour_mat.html">colour_mat</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span> <span class="op">(</span><span class="fl">4</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, rotate <span class="op">=</span> <span class="fl">90</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-maps_files/figure-html/unnamed-chunk-13-1.png" width="384"></p>
<p>This example also illustrates that the size of colour matrices may
also be arbitrarily specified. Using the <code>colmat</code> option in
<code>add_osm_groups</code> enables the previous maps to be redrawn like
this:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray95"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>        border_width <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        colmat <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>        rotate <span class="op">=</span> <span class="fl">180</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b14.png"></p>
<p>Note both that when <code>add_osm_groups</code> is called with
<code>colmat = TRUE</code>, then <code>cols</code> need only be of
length 4, to specify the four corners of the colour matrix, and also
that the <code>rotate</code> argument can be submitted to
<code>add_osm_groups</code> and passed on to
<code>colour_mat</code>.</p>
</div>
<div class="section level3">
<h3 id="bounding-areas-within-named-highways">1.7 Bounding areas within named highways<a class="anchor" aria-label="anchor" href="#bounding-areas-within-named-highways"></a>
</h3>
<p>As explained in the first vignette, <a href="https://cran.r-project.org/package=osmplotr" class="external-link">Basic maps</a>, the
function <code>connect_highways</code> takes a list of OSM highway names
and a bounding box, and returns the boundary of a polygon encircling the
named highways. This can be used to highlight selected regions simply by
naming the highways which encircle them, producing maps which look like
this:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">highways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span></span>
<span>    <span class="st">"Monmouth.St"</span>, <span class="st">"Short.?s.Gardens"</span>, <span class="st">"Endell.St"</span>, <span class="st">"Long.Acre"</span>,</span>
<span>    <span class="st">"Upper.Saint.Martin"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">highways1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_highways.html">connect_highways</a></span> <span class="op">(</span>highways <span class="op">=</span> <span class="va">highways</span>, bbox <span class="op">=</span> <span class="va">bbox</span><span class="op">)</span></span>
<span><span class="va">highways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"Endell.St"</span>, <span class="st">"High.Holborn"</span>, <span class="st">"Drury.Lane"</span>, <span class="st">"Long.Acre"</span><span class="op">)</span></span>
<span><span class="va">highways2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_highways.html">connect_highways</a></span> <span class="op">(</span>highways <span class="op">=</span> <span class="va">highways</span>, bbox <span class="op">=</span> <span class="va">bbox</span><span class="op">)</span></span>
<span><span class="va">highways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"Drury.Lane"</span>, <span class="st">"High.Holborn"</span>, <span class="st">"Kingsway"</span>, <span class="st">"Great.Queen.St"</span><span class="op">)</span></span>
<span><span class="va">highways3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_highways.html">connect_highways</a></span> <span class="op">(</span>highways <span class="op">=</span> <span class="va">highways</span>, bbox <span class="op">=</span> <span class="va">bbox</span><span class="op">)</span></span></code></pre></div>
<p>Note the use of the <a href="https://en.wikipedia.org/wiki/Regular_expression" class="external-link">regex</a>
character <code>?</code> in the first list of highway names, denoting
the previous character as optional. This is necessary here because there
are OSM sections named both “Shorts Gardens” and “Short’s Gardens”.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span> <span class="op">(</span><span class="va">highways1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "matrix" "array"</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">highways1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 41</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">highways2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 33</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span> <span class="op">(</span><span class="va">highways3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 53</span></span></code></pre>
<p><code>connect_highways</code> returns a list of
<code>SpatialPoints</code> representing the shortest path that
sequentially connects all of the listed highways. (Connecting all listed
highways may not necessarily be possible, in which case warnings will be
issued. As described in the first vignette, <a href="https://cran.r-project.org/package=osmplotr" class="external-link">Basic maps</a>,
<code>connect_highways</code> also has a <code>plot</code> option
allowing problematic cases to be visually inspected and hopefully
corrected.)</p>
<p>These lists of highway coordinates can then be used to highlight the
areas they encircle. First group the highways and establish a colour
scheme for the map:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="va">highways1</span>, <span class="va">highways2</span>, <span class="va">highways3</span><span class="op">)</span></span>
<span><span class="va">cols_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"tomato"</span><span class="op">)</span> <span class="co"># for the 3 groups</span></span>
<span><span class="va">cols_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_colours.html">adjust_colours</a></span> <span class="op">(</span><span class="va">cols_B</span>, <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">bg_B</span> <span class="op">&lt;-</span> <span class="st">"gray40"</span></span>
<span><span class="va">bg_H</span> <span class="op">&lt;-</span> <span class="st">"gray60"</span></span></code></pre></div>
<p>And then plot the map.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, bg <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_objects.html">add_osm_objects</a></span> <span class="op">(</span><span class="va">dat_P</span>,</span>
<span>        col <span class="op">=</span> <span class="va">col_park_out</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        bg <span class="op">=</span> <span class="va">bg_B</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_B</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_H</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        bg <span class="op">=</span> <span class="va">bg_H</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_H</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_groups.html">add_osm_groups</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>        boundary <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_H</span>,</span>
<span>        bg <span class="op">=</span> <span class="va">bg_H</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b15.png"></p>
<p>These encircling highways are included in the <code>london</code>
data provided with <code>osmplotr</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="continuous-data-add_osm_surface">2. Continuous data: <code>add_osm_surface</code><a class="anchor" aria-label="anchor" href="#continuous-data-add_osm_surface"></a>
</h2>
<p>The <code>add_osm_surface</code> function enables a continuous data
surface to be overlaid on a map. User-provided data is spatially
interpolated across a map region and OSM items coloured according to a
specified continuous colour gradient. The data must be provided as a
data frame with three columns, ‘(x,y,z)’, where ‘(x,y)’ are the
coordinates of points at which data are given, and ‘z’ are the values to
be spatially interpolated across the map.</p>
<p>A simple data frame can be constructed as</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="va">bbox</span> <span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span> <span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span> <span class="op">(</span><span class="va">bbox</span> <span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span> <span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span> <span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span> <span class="op">(</span><span class="va">x</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span> <span class="op">(</span><span class="va">y</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    z <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        x       y         z</span></span>
<span><span class="co">## 1 -0.130 51.5100 -6.696300</span></span>
<span><span class="co">## 2 -0.125 51.5100 -6.439063</span></span>
<span><span class="co">## 3 -0.120 51.5100 -6.181800</span></span>
<span><span class="co">## 4 -0.115 51.5100 -5.924512</span></span>
<span><span class="co">## 5 -0.110 51.5100 -5.667200</span></span>
<span><span class="co">## 6 -0.130 51.5125 -6.696300</span></span></code></pre>
<p>And then passed to <code>add_osm_surface</code></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b16.png"></p>
<p>At present, <code>add_osm_surface</code> generates an warning if it
is applied more than once to any one kind of <code>Spatial</code> object
(polygons or lines), as illustrated in the following code (in which both
<code>dat_H</code> and <code>dat_HP</code> are of class
<code>SpatialLinesDataFrame</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, bg <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_H</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="data-maps_files/figure-html/unnamed-chunk-18-1.png" width="700">
This is because <code>add_osm_surface</code> creates new
<code>ggplot2</code> aesthetic schemes for each kind of object, and
these schemes are not intended to be modified or replaced within a
single plot. The above map may still be printed, but the warning means
that the last provided colour scheme will be applied to all objects of
that class. This means that <code>osmplotr</code> can only overlay two
distinct colour schemes: one for all objects of class
<code>SpatialLines</code>, and a potentially different one for all
objects of class <code>SpatialPolygons</code>.</p>
<p>Of course, any number of additional objects may be overlaid with
<code>add_osm_objects</code>, for example,</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_colours.html">adjust_colours</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_adj</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1.5</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_objects.html">add_osm_objects</a></span> <span class="op">(</span><span class="va">dat_P</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span> <span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_objects.html">add_osm_objects</a></span> <span class="op">(</span><span class="va">dat_H</span>,</span>
<span>        col <span class="op">=</span> <span class="st">"gray60"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b17.png"></p>
<div class="section level3">
<h3 id="colourbar-legends-for-data-surfaces">2.1 Colourbar legends for data surfaces<a class="anchor" aria-label="anchor" href="#colourbar-legends-for-data-surfaces"></a>
</h3>
<p>A colourbar legend for the surface may be added with
<code>add_colourbar</code>. As with <code>add_axes</code>, this function
is provided separately to allow colourbars to be overlaid only after all
desired map items have been added. The only parameters required for
<code>add_colourbar</code> are the limits of the data
(<code>zlims</code>) and the colours (along with the <code>map</code>, a
modified version of which is returned).</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_colourbar.html">add_colourbar</a></span> <span class="op">(</span></span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span> <span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>        zlims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">z</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b18.png"></p>
<p>Note that the colours submitted to <code>add_colourbar</code> need
not be the same as those used to plot the surface. (Although using
different colours is rarely likely to be useful.) As for
<code>add_axes</code>, and explained in the first vignette, <a href="https://cran.r-project.org/package=osmplotr" class="external-link">Basic maps</a>, the
transparency of the boxes surrounding the elements of the colourbar may
be controlled by specifying the value of <code>alpha</code>. Both
alignment and position may also be adjusted, as illustrated in this
example.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_colours.html">adjust_colours</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_adj</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1.5</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_colourbar.html">add_colourbar</a></span> <span class="op">(</span></span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>        zlims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">z</span><span class="op">)</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>        vertical <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        barwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.12</span><span class="op">)</span>,</span>
<span>        barlength <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>        text_col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>        fontsize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        fontface <span class="op">=</span> <span class="fl">3</span>,</span>
<span>        fontfamily <span class="op">=</span> <span class="st">"Times"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_axes.html">add_axes</a></span> <span class="op">(</span></span>
<span>        colour <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>        fontsize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        fontface <span class="op">=</span> <span class="fl">3</span>,</span>
<span>        fontfamily <span class="op">=</span> <span class="st">"Times"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b19.png"></p>
<p>Both <code>barwidth</code> and <code>barlength</code> can be
specified in terms of one or two numbers. A single value for
<code>barwidth</code> determines its relative width (0-1) from the
border (the right side if <code>vertical = TRUE</code> or the top if
<code>vertical = FALSE</code>), while two values determine the relative
start and end positions of the sides of the bar. A single value for
<code>barlength</code> produces a bar of the given length centred in the
middle of the map, while two values determine its respective upper and
lower points (for <code>vertical = TRUE</code>) or left and right points
(for <code>vertical = FALSE</code>).</p>
<p>This example also demonstrates how colours, sizes, and other font
characteristics of text labels can be specified (with
<code>text_col</code> determining the colour of all elements of the
colourbar other than the gradient itself). Finally, as for
<code>add_axes</code>, the text labels of colourbars are not currently
able to be rotated because <code>ggplot2</code> does not permit rotation
for the <code>geom_label</code> function used to produce these
labels.</p>
</div>
<div class="section level3">
<h3 id="surfaces-and-data-perimeters">2.1 Surfaces and data perimeters<a class="anchor" aria-label="anchor" href="#surfaces-and-data-perimeters"></a>
</h3>
<p>It may often be that user-provided data only extend across a portion
of a map, leaving a perimeter beyond the data boundary for which
interpolation should not be applied. <code>add_osm_surface</code> has a
<code>bg</code> parameter specifying a background colour for objects
beyond the perimeter of the data surface. Passing this parameter to
<code>add_osm_surface</code> causes objects beyond the data perimeter to
be coloured within this ‘background’ colour.</p>
<p>To illustrate, trim the above data to within a circular range of the
centre of the map.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span> <span class="op">(</span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span> <span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span> <span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.00000000 0.01118034</span></span></code></pre>
<p>Remove from <code>dat</code> all rows translating to
<code>d&gt;0.01</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span> <span class="op">(</span><span class="va">d</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">cols_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_colours.html">adjust_colours</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span>, <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_B</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray40"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="va">cols_adj</span>,</span>
<span>        size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray70"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b20.png"></p>
<p>(The perimeter is irregular because of the positions of the points in
<code>dat</code>.)</p>
</div>
<div class="section level3">
<h3 id="further-control-of-surface-appearance">2.3 Further control of surface appearance<a class="anchor" aria-label="anchor" href="#further-control-of-surface-appearance"></a>
</h3>
<p>The final <code>add_osm_surface</code> call in the above code (for
<code>dat_HP</code>) illustrates additional parameters that may be
passed for further control of map appearance. In this case, the two
<code>size</code> parameters control the size of the lines within the
data surface and beyond its perimeter. Single values may also be passed,
in which case they determine the width of lines in both cases. One or
two <code>shape</code> parameters may also be passed, with these also
determining the shapes of <code>SpatialPoints</code>, as illustrated in
the next example, which overlays trees on the map.</p>
<p>Both lines and points use the same <code>ggplot2</code> colour
gradient, and so adding the second of these again generates an error and
means that the actual colour scheme will be determined by the final call
to add either lines or points.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_osm_objects.html">extract_osm_objects</a></span> <span class="op">(</span>key <span class="op">=</span> <span class="st">"tree"</span>, bbox <span class="op">=</span> <span class="va">bbox</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osm_basemap.html">osm_basemap</a></span> <span class="op">(</span></span>
<span>    bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"gray20"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_HP</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray70"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_H</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"gray70"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_surface.html">add_osm_surface</a></span> <span class="op">(</span><span class="va">dat_T</span>,</span>
<span>        dat <span class="op">=</span> <span class="va">dat</span>,</span>
<span>        cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span> <span class="op">(</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>        bg <span class="op">=</span> <span class="st">"lawngreen"</span>,</span>
<span>        size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="fl">8</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/print_osm_map.html">print_osm_map</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="map_b21.png"></p>
<p>The first two colour specifications (<code>terrain.colors</code>)
have been ignored, and all added items are coloured according to the
final value of <code>heat.colors (30)</code>. Other aspects such as line
sizes and point shapes are nevertheless respected.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
